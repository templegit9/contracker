<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Engagement Tracker</title>
    <!-- Include Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include Chart.js for visualization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Include localforage for client-side storage -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Engagement Tracker</h1>
            <p class="text-gray-600">Track and analyze your engagement activities</p>
        </header>

        <!-- Main Content -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Engagement Form -->
            <div class="bg-white rounded-lg shadow-md p-6 md:col-span-1">
                <h2 class="text-xl font-semibold mb-4">Log Engagement</h2>
                <form id="engagement-form" class="space-y-4">
                    <div>
                        <label for="contact-name" class="block text-sm font-medium text-gray-700">Contact Name</label>
                        <input type="text" id="contact-name" name="contact-name" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                    </div>
                    <div>
                        <label for="engagement-type" class="block text-sm font-medium text-gray-700">Engagement Type</label>
                        <select id="engagement-type" name="engagement-type" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                            <option value="email">Email</option>
                            <option value="call">Call</option>
                            <option value="meeting">Meeting</option>
                            <option value="demo">Demo</option>
                            <option value="follow-up">Follow-up</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="engagement-date" class="block text-sm font-medium text-gray-700">Date</label>
                        <input type="date" id="engagement-date" name="engagement-date" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                    </div>
                    <div>
                        <label for="engagement-notes" class="block text-sm font-medium text-gray-700">Notes</label>
                        <textarea id="engagement-notes" name="engagement-notes" rows="3"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border"></textarea>
                    </div>
                    <div>
                        <label for="engagement-outcome" class="block text-sm font-medium text-gray-700">Outcome</label>
                        <select id="engagement-outcome" name="engagement-outcome" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                            <option value="positive">Positive</option>
                            <option value="neutral">Neutral</option>
                            <option value="negative">Negative</option>
                            <option value="follow-up-required">Follow-up Required</option>
                        </select>
                    </div>
                    <button type="submit"
                        class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Log Engagement
                    </button>
                </form>
            </div>

            <!-- Recent Engagements -->
            <div class="bg-white rounded-lg shadow-md p-6 md:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">Recent Engagements</h2>
                    <button id="export-data" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm">
                        Export Data
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Outcome</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="engagement-list" class="bg-white divide-y divide-gray-200">
                            <!-- Engagement entries will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Section -->
            <div class="bg-white rounded-lg shadow-md p-6 md:col-span-2">
                <h2 class="text-xl font-semibold mb-4">Engagement Analytics</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h3 class="text-lg font-medium mb-2">Engagement by Type</h3>
                        <canvas id="engagement-type-chart" class="w-full"></canvas>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium mb-2">Engagement Outcomes</h3>
                        <canvas id="engagement-outcome-chart" class="w-full"></canvas>
                    </div>
                </div>
            </div>

            <!-- Contact List -->
            <div class="bg-white rounded-lg shadow-md p-6 md:col-span-1">
                <h2 class="text-xl font-semibold mb-4">Contacts</h2>
                <div id="contact-list" class="space-y-2">
                    <!-- Contact list will be added here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for viewing engagement details -->
    <div id="engagement-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full">
            <div class="flex justify-between items-start">
                <h3 class="text-xl font-semibold" id="modal-title">Engagement Details</h3>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700">&times;</button>
            </div>
            <div id="modal-content" class="mt-4">
                <!-- Modal content will be added here -->
            </div>
        </div>
    </div>

    <script>
        // Initialize localforage
        localforage.config({
            name: 'engagement-tracker'
        });

        // Data structure
        let engagements = [];
        let contacts = new Set();

        // Chart instances
        let typeChart;
        let outcomeChart;

        // DOM elements
        const engagementForm = document.getElementById('engagement-form');
        const engagementList = document.getElementById('engagement-list');
        const contactList = document.getElementById('contact-list');
        const exportDataBtn = document.getElementById('export-data');
        const modal = document.getElementById('engagement-modal');
        const closeModal = document.getElementById('close-modal');

        // Initialize the app
        async function initApp() {
            // Load saved data
            const savedEngagements = await localforage.getItem('engagements');
            if (savedEngagements) {
                engagements = JSON.parse(savedEngagements);
                engagements.forEach(engagement => {
                    contacts.add(engagement.contactName);
                });
            }

            // Set today's date as default
            document.getElementById('engagement-date').valueAsDate = new Date();

            // Render data
            renderEngagements();
            renderContacts();
            renderCharts();

            // Add event listeners
            engagementForm.addEventListener('submit', handleFormSubmit);
            exportDataBtn.addEventListener('click', exportData);
            closeModal.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
        }

        // Handle form submission
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const contactName = document.getElementById('contact-name').value;
            const engagementType = document.getElementById('engagement-type').value;
            const engagementDate = document.getElementById('engagement-date').value;
            const engagementNotes = document.getElementById('engagement-notes').value;
            const engagementOutcome = document.getElementById('engagement-outcome').value;

            const newEngagement = {
                id: Date.now().toString(),
                contactName,
                type: engagementType,
                date: engagementDate,
                notes: engagementNotes,
                outcome: engagementOutcome,
                timestamp: new Date().toISOString()
            };

            // Add to data structure
            engagements.unshift(newEngagement);
            contacts.add(contactName);
            
            // Save to localforage
            await localforage.setItem('engagements', JSON.stringify(engagements));
            
            // Update UI
            renderEngagements();
            renderContacts();
            renderCharts();
            
            // Reset form
            engagementForm.reset();
            document.getElementById('engagement-date').valueAsDate = new Date();
        }

        // Render engagement list
        function renderEngagements() {
            engagementList.innerHTML = '';
            
            if (engagements.length === 0) {
                engagementList.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">No engagements recorded yet</td></tr>';
                return;
            }
            
            engagements.forEach(engagement => {
                const row = document.createElement('tr');
                
                const dateCell = document.createElement('td');
                dateCell.className = 'px-6 py-4 whitespace-nowrap';
                dateCell.textContent = formatDate(engagement.date);
                
                const contactCell = document.createElement('td');
                contactCell.className = 'px-6 py-4 whitespace-nowrap';
                contactCell.textContent = engagement.contactName;
                
                const typeCell = document.createElement('td');
                typeCell.className = 'px-6 py-4 whitespace-nowrap';
                typeCell.textContent = capitalizeFirstLetter(engagement.type);
                
                const outcomeCell = document.createElement('td');
                outcomeCell.className = 'px-6 py-4 whitespace-nowrap';
                const outcomeSpan = document.createElement('span');
                outcomeSpan.textContent = capitalizeFirstLetter(engagement.outcome.replace('-', ' '));
                
                // Add color based on outcome
                if (engagement.outcome === 'positive') {
                    outcomeSpan.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800';
                } else if (engagement.outcome === 'negative') {
                    outcomeSpan.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800';
                } else if (engagement.outcome === 'follow-up-required') {
                    outcomeSpan.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800';
                } else {
                    outcomeSpan.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800';
                }
                
                outcomeCell.appendChild(outcomeSpan);
                
                const actionsCell = document.createElement('td');
                actionsCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
                
                const viewBtn = document.createElement('button');
                viewBtn.className = 'text-blue-600 hover:text-blue-900 mr-3';
                viewBtn.textContent = 'View';
                viewBtn.addEventListener('click', () => showEngagementDetails(engagement));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-red-600 hover:text-red-900';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', () => deleteEngagement(engagement.id));
                
                actionsCell.appendChild(viewBtn);
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(dateCell);
                row.appendChild(contactCell);
                row.appendChild(typeCell);
                row.appendChild(outcomeCell);
                row.appendChild(actionsCell);
                
                engagementList.appendChild(row);
            });
        }

        // Render contact list
        function renderContacts() {
            contactList.innerHTML = '';
            
            if (contacts.size === 0) {
                contactList.innerHTML = '<p class="text-gray-500">No contacts yet</p>';
                return;
            }
            
            // Sort contacts alphabetically
            const sortedContacts = Array.from(contacts).sort();
            
            sortedContacts.forEach(contact => {
                const contactDiv = document.createElement('div');
                contactDiv.className = 'flex justify-between items-center p-2 hover:bg-gray-50 rounded';
                
                const contactName = document.createElement('span');
                contactName.textContent = contact;
                
                const contactCount = document.createElement('span');
                const count = engagements.filter(e => e.contactName === contact).length;
                contactCount.textContent = count;
                contactCount.className = 'bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full';
                
                contactDiv.appendChild(contactName);
                contactDiv.appendChild(contactCount);
                
                contactList.appendChild(contactDiv);
            });
        }

        // Render charts
        function renderCharts() {
            // Prepare data for type chart
            const typeData = {};
            engagements.forEach(engagement => {
                typeData[engagement.type] = (typeData[engagement.type] || 0) + 1;
            });
            
            // Prepare data for outcome chart
            const outcomeData = {};
            engagements.forEach(engagement => {
                outcomeData[engagement.outcome] = (outcomeData[engagement.outcome] || 0) + 1;
            });
            
            // Create or update type chart
            const typeCtx = document.getElementById('engagement-type-chart').getContext('2d');
            if (typeChart) {
                typeChart.destroy();
            }
            
            typeChart = new Chart(typeCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(typeData).map(type => capitalizeFirstLetter(type)),
                    datasets: [{
                        data: Object.values(typeData),
                        backgroundColor: [
                            '#3B82F6', // blue
                            '#10B981', // green
                            '#F59E0B', // yellow
                            '#EF4444', // red
                            '#8B5CF6', // purple
                            '#EC4899'  // pink
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Create or update outcome chart
            const outcomeCtx = document.getElementById('engagement-outcome-chart').getContext('2d');
            if (outcomeChart) {
                outcomeChart.destroy();
            }
            
            outcomeChart = new Chart(outcomeCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(outcomeData).map(outcome => 
                        capitalizeFirstLetter(outcome.replace('-', ' '))
                    ),
                    datasets: [{
                        data: Object.values(outcomeData),
                        backgroundColor: [
                            '#10B981', // green - positive
                            '#9CA3AF', // gray - neutral
                            '#EF4444', // red - negative
                            '#F59E0B'  // yellow - follow-up required
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Show engagement details in modal
        function showEngagementDetails(engagement) {
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="space-y-3">
                    <div>
                        <h4 class="text-sm font-medium text-gray-500">Contact</h4>
                        <p class="text-gray-900">${engagement.contactName}</p>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-gray-500">Type</h4>
                        <p class="text-gray-900">${capitalizeFirstLetter(engagement.type)}</p>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-gray-500">Date</h4>
                        <p class="text-gray-900">${formatDate(engagement.date)}</p>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-gray-500">Outcome</h4>
                        <p class="text-gray-900">${capitalizeFirstLetter(engagement.outcome.replace('-', ' '))}</p>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-gray-500">Notes</h4>
                        <p class="text-gray-900">${engagement.notes || 'No notes provided'}</p>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-gray-500">Recorded on</h4>
                        <p class="text-gray-900">${new Date(engagement.timestamp).toLocaleString()}</p>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // Delete engagement
        async function deleteEngagement(id) {
            if (confirm('Are you sure you want to delete this engagement?')) {
                engagements = engagements.filter(engagement => engagement.id !== id);
                
                // Recalculate contacts
                contacts.clear();
                engagements.forEach(engagement => {
                    contacts.add(engagement.contactName);
                });
                
                // Save to localforage
                await localforage.setItem('engagements', JSON.stringify(engagements));
                
                // Update UI
                renderEngagements();
                renderContacts();
                renderCharts();
            }
        }

        // Export data as CSV
        function exportData() {
            if (engagements.length === 0) {
                alert('No data to export');
                return;
            }
            
            const headers = ['Contact Name', 'Engagement Type', 'Date', 'Notes', 'Outcome', 'Recorded Time'];
            
            const csvData = engagements.map(engagement => [
                engagement.contactName,
                engagement.type,
                engagement.date,
                `"${engagement.notes.replace(/"/g, '""')}"`, // Escape quotes
                engagement.outcome,
                engagement.timestamp
            ]);
            
            // Add headers
            csvData.unshift(headers);
            
            // Convert to CSV string
            const csvString = csvData.map(row => row.join(',')).join('\n');
            
            // Create download link
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `engagement-data-${new Date().toISOString().slice(0, 10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Helper functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }

        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
